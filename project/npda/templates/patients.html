{% extends 'base.html' %}
{% load static %}
{% load npda_tags %}
{% block content %}
  <div hx-get="/patients" hx-trigger="patients from:body" hx-target="#patient_table">
    <div class="flex flex-wrap">
      <label class="form-control flex items-center gap-2 grow">
        <label class="bg-rcpch_strong_blue mx-6 text-white input flex items-center gap-2 w-full h-auto">
          <div class="hidden lg:block">
            <i class="fa-solid fa-hospital-user text-white mr-2"></i> Patient search
          </div>
          <div class="divider divider-horizontal after:bg-rcpch_strong_blue_light_tint1 before:bg-rcpch_strong_blue_light_tint3 hidden lg:flex"></div>
          <div class="hidden lg:block tooltip tooltip-top" data-tip="You can search for a patient by first name, surname or fullname.">
            <i class="fas fa-circle-question"></i>
          </div>
          <input type="text" class="text-center grow placeholder-gray-300 focus:bg-rcpch_strong_blue_light_tint2 hover:bg-rcpch_strong_blue_light_tint2 focus:placeholder-gray-500 p-2 m-2" placeholder="Search by patient name..." id="search-input" name="search-input" hx-get="{% url 'patients' %}" hx-trigger="keyup changed delay:500ms" hx-target="#patient_table" hx-swap="innerHTML" hx-include="[name='search-input']" hx-params="*" hx-indicator="#search_spinner" />
          <div id="search_spinner" class="htmx-indicator flex items-center px-4 text-white absolute right-14 loading loading-bars loading-sm"></div>
        </label>
      </label>
      <button class="btn btn-info h-auto w-full md:w-auto" hx-include="#search-input" hx-swap="innerHTML" hx-target="#patient_table" hx-trigger="click" hx-indicator="#search_spinner" hx-get="{% url 'patients' %}" hx-disabled-elt="this">
        <span class="md:hidden text-white">Search patients</span>
        <i class="fa-solid fa-magnifying-glass text-white"></i>
      </button>
    </div>
    <div class="flex flex-col justify-center px-10">
      <div class="">
        <div class="">
          <div class="relative">
            <div class="mt-1 menu bg-base-200 lg:menu-horizontal rounded-box w-full shadow-sm shadow-rcpch_strong_blue_dark_tint mb-2">
              <div class="flex sm:hidden divider m-0 h-auto font-bold">Quick access</div>
              <div class="hidden sm:flex divider divider-vertical m-0 h-auto font-bold">Quick access</div>
              <div class="flex justify-items-stretch grow align-middle justify-between flex-wrap">
                <ul class="flex items-center flex-wrap grow">
                  <li>
                    <a href="{% url 'patients' %}">
                      <i class="fa-solid fa-hospital-user"></i>Patient Index
                      <span class="badge badge-sm">ALL</span>
                    </a>
                  </li>
                </ul>
                <ul class="flex items-center flex-wrap">
                  <li>
                    <div class="tooltip tooltip-bottom" data-tip="No updates to display.">
                      <button class="opacity-40" disabled><i class="fa-solid fa-circle-exclamation"></i> Notifications</button>
                    </div>
                  </li>
                  {% if perms.npda.add_patient %}
                    <li>
                      <a href="{% url 'patient-add' %}" class="underline decoration-rcpch_strong_blue hover:decoration-rcpch_pink decoration-2 underline-offset-4">
                        <i class="fa-solid fa-person-circle-plus"></i>
                        Add child
                      </a>
                    </li>
                  {% endif %}
                </ul>
              </div>
            </div>
            <div id="patient_table" class="w-full overflow-x-scroll">
              {% include 'partials/patient_table.html' with patient_list=patient_list index_of_first_invalid_patient=index_of_first_invalid_patient total_invalid_patients=total_invalid_patients %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
